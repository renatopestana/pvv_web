{% extends "base.html" %}
{% from "_macros/forms.html" import render_field, render_select %}
{% block content %}

<div class="max-w-5xl mx-auto">
  <div class="bg-base-200 text-base-content rounded-xl p-6 md:p-8 shadow">
    <h3 class="text-xl font-semibold mb-4">{{ title }}</h3>
    <form method="post" action="{{ request.path }}" id="stakeholder-form" novalidate>

      {{ form.hidden_tag() }}
      {{ render_field(form.name) }}
      {{ render_select(form.tipo) }}

      <div id="cliente-wrapper">
        {{ render_select(form.client_id) }}
      </div>
      <div id="posicao-wrapper">
        {{ render_select(form.position_id) }}
      </div>

      <div class="mt-6 flex gap-2">
        {{ form.submit(class="btn btn-primary") }}
        <a href="{{ url_for('stakeholders.list') }}" class="btn btn-secondary">Voltar</a>
      </div>
    </form>
  </div>
</div>

<script>
  (function () {
    const tipoEl = document.getElementById('{{ form.tipo.id }}');
    const clienteWrapper = document.getElementById('cliente-wrapper');
    const posicaoWrapper = document.getElementById('posicao-wrapper');
    const cliSelect = document.getElementById('{{ form.client_id.id }}');
    const posSelect = document.getElementById('{{ form.position_id.id }}');

    function toggleFields() {
      const tipo = tipoEl ? tipoEl.value : '';
      if (tipo === 'EXTERNO') {
        clienteWrapper.style.display = '';
        posicaoWrapper.style.display = 'none';
        if (posSelect) posSelect.value = '0';  // placeholder 0
      } else if (tipo === 'INTERNO') {
        clienteWrapper.style.display = 'none';
        posicaoWrapper.style.display = '';
        if (cliSelect) cliSelect.value = '0';
      } else {
        clienteWrapper.style.display = 'none';
        posicaoWrapper.style.display = 'none';
        if (cliSelect) cliSelect.value = '0';
        if (posSelect) posSelect.value = '0';
      }
    }

    document.addEventListener('DOMContentLoaded', toggleFields);
    if (tipoEl) tipoEl.addEventListener('change', toggleFields);
  })();
</script>
{% endblock %}
