{% extends "base.html" %}
{% from "_macros/forms.html" import render_field, render_select %}
{% block content %}

<div class="max-w-5xl mx-auto">
  <div class="bg-base-200 text-base-content rounded-xl p-6 md:p-8 shadow">
    <h3 class="text-xl font-semibold mb-4">{{ title }}</h3>
    <form method="post" action="{{ request.path }}" id="stakeholder-form" novalidate>

      {{ form.hidden_tag() }}
      {{ render_field(form.name) }}
      <div class="grid" style="display:grid;grid-template-columns:repeat(12,1fr);gap:1rem;">
        <div style="grid-column:span 6;">{{ render_select(form.tipo) }}</div>
        <div style="grid-column:span 6;">{{ render_select(form.position_id, label="Posição (Cargo)") }}</div>
      </div>

      <div id="cliente-wrapper" style="display:none;">
        {{ render_select(form.client_id, label="Cliente") }}
      </div>

      <div class="grid" style="display:grid;grid-template-columns:repeat(12,1fr);gap:1rem;">
        <div style="grid-column:span 6;">
          {{ render_field(form.email, label="E-mail", placeholder="nome@exemplo.com") }}
        </div>
        <div style="grid-column:span 6;">
          {{ render_field(form.phone, label="Telefone", placeholder="(XX) 99999-9999") }}
        </div>
      </div>

      <div class="mt-6 flex gap-2">
        {{ form.submit(class="btn btn-primary") }}
        <a href="{{ url_for('stakeholders.list') }}" class="btn btn-secondary">Voltar</a>
      </div>
    </form>
  </div>
</div>


<script>
(function () {
  const tipoEl = document.getElementById('{{ form.tipo.id }}');
  const cliWrap = document.getElementById('cliente-wrapper');
  const cliSel  = document.getElementById('{{ form.client_id.id }}');

  function toggleCliente() {
    const tipo = (tipoEl?.value || '').toUpperCase();
    if (tipo === 'EXTERNO') {
      cliWrap.style.display = '';
    } else {
      cliWrap.style.display = 'none';
      if (cliSel) cliSel.value = '0';
    }
  }

  document.addEventListener('DOMContentLoaded', toggleCliente);
  tipoEl && tipoEl.addEventListener('change', toggleCliente);
})();
</script>

{% endblock %}
